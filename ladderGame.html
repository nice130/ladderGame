<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사다리타기</title>
    <style>
        @import url("ladderStyle.css");
    </style>
</head>
<body>
    <!-- <div id="app">
        <h1>사다리타기</h1>
        <div id="participant"> 
            
            참가자 수 
            <button onclick="participant(this)" value="minus">-</button>
               
                <span id="participantNumber"></span>
            <button onclick="participant(this)" value="plus">+</button>
            <button onclick="start()">게임생성</button>
        </div>
        
        <div>
            <div id="game_field" style="text-align: center;">
              
            </div>
            <canvas class="canvas" id="canvas">
            </canvas>
        </div>
    </div> -->
    <div id="app">
        <h1>사다리타기</h1>
        <div id="participant"> 
            <!-- 인원수 설정 -->
            참가자 수 
            <button onclick="participant(this)" value="minus">-</button>
                <!-- 몇명변수추가 -->
                <span id="participantNumber"></span>
            <button onclick="participant(this)" value="plus">+</button>
            <button onclick="start()">게임생성</button>
        </div>
        <div style="text-align: center;">
            
            <div id="game_field">
                <!-- 버튼생성 -->
            </div>
        </div>
        <canvas id='canvas' width="600" height="400"> </canvas>
    </div>

    <script>
        var canvas = document.getElementById("canvas"); 
        var ctx = canvas.getContext("2d");
        let width = canvas.width
        let height = canvas.height
        console.log(canvas.offsetTop+height);
        let butHeight = canvas.offsetTop+(height*0.9);
        
        let participantion = 2; //기본 참여인원 
        let $game_field = document.getElementById("game_field")
        let $participantNumber = document.getElementById("participantNumber")
        $participantNumber.innerText= participantion;
        let option = {};
        
        let defaultLineWidth = 3
        let defaultLineColor = '#A6ABCA'
        let data = [ ]

        function start(option={}){
            
            $game_field.innerHTML=''
            
            let line = option.line || participantion  //line ;
            
            for(let i=0;i<participantion;i++){
                let coordinatesX = i / line * width + 1/line * width / 2.4
                let num = i+1;
                console.log(num)
                $game_field.innerHTML +='<button class="btn" type="button" style="left:'+coordinatesX+'px;" id="btn'+num+'">'+num+'번</button>';
                $game_field.innerHTML +='<div class="btn" id="res_'+i+'" style="left:'+coordinatesX+'px; top:'+butHeight+'px"><div>';
            }
            for(let i=0;i<participantion;i++){
                let id = 'btn' + (i+1);
                document.getElementById(id).addEventListener('click', (event) =>{
                    lad.find(i, 'red')
                });
            }
            lineY();
            function lineY(){
                for(let i = 0 ; i < line ; i++){
                    let coordinatesX = i / line * width + 1/line * width / 2
                    ctx.save()
                    ctx.beginPath()
                    ctx.lineWidth = defaultLineWidth
                    ctx.strokeStyle = defaultLineColor
                    ctx.moveTo(coordinatesX, height * 0.1)
                    ctx.lineTo(coordinatesX, height * 0.9) 
                    ctx.stroke()
                    ctx.closePath()
                    ctx.restore()  
                    let arr = [
                        {x : coordinatesX, y : height * 0.1},
                        {x : coordinatesX, y : height * 0.9}
                    ]
                    data.push(arr)
                }
                arraySort()
            }
        }
        
        //인원수 변경
        const participant=(val)=>{
            value=val.value;
            // $game_field.getBoundingClientRect().bottom;
            if(value=='minus'){
                if(participantion =='2'){
                    alert("참가자는2명이상이여야합니다");
                    return;
                }
                participantion--;
                $participantNumber.innerText= participantion;
            }else{
                participantion++;
                $participantNumber.innerText= participantion;
            }
        }
        function initLad(){
            function userDrawLine(){
                for(let i = 0 ; i < line ; i++){
                    let startPcoordinatesXosX = i / line * width + 1/line * width / 2
                    ctx.save()
                    ctx.beginPath()
                    ctx.lineWidth = defaultLineWidth
                    ctx.strokeStyle = defaultLineColor
                    ctx.moveTo(coordinatesX, height * 0.1)
                    ctx.lineTo(coordinatesX, height * 0.9)
                    ctx.stroke()
                    ctx.closePath()
                    ctx.restore()  
                }

                lineData.forEach(item => {
                    let {startBridge, endBridge} = item
                    ctx.save()
                    ctx.beginPath()
                    ctx.lineWidth = defaultLineWidth
                    ctx.strokeStyle = defaultLineColor
                    ctx.moveTo(startBridge.x, startBridge.y)
                    ctx.lineTo(endBridge.x, endBridge.y)
                    ctx.stroke()
                    ctx.closePath()
                    ctx.restore()              
                })
                arraySort()
            }
        }
        //내림차순으로 정렬
        function arraySort(){
            data.map( arg=>{
                arg.sort((a, b) => a.y - b.y)
                return arg
            })
        }

        //판 초기화
        function init(){
           ctx.save();
           ctx.clearReact(0,0,width,height);
           ctx.restore();
        }
        let initLadder = initLad();
    </script>
</body>
</html>